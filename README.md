# Telegram Bot для проверки заявок в канал

Бот обрабатывает заявки на вступление в канал и работает по схеме:

1. Пользователь подает заявку в канал.
2. Бот автоматически пишет пользователю, что заявка получена.
3. Бот оценивает "возраст" аккаунта (эвристика по ID).
4. Если аккаунт выглядит новым, заявка уходит администратору на ручное решение.
5. Если аккаунт не выглядит новым, бот выдает капчу.
6. После верной капчи бот автоматически одобряет заявку в канал.

## Важно

Telegram Bot API не отдает точную дату регистрации аккаунта.  
Поэтому в проекте используется **оценка возраста аккаунта по диапазону `user_id`**. Это эвристика, а не точное значение.

## Требования

- Python 3.10+
- Бот добавлен в канал как админ
- У бота есть право на работу с заявками (`invite users` / `manage join requests`)
- В канале включены заявки на вступление

## Установка

```bash
python -m venv .venv
pip install -r requirements.txt
```

Активация окружения:

- Windows (PowerShell): `.venv\Scripts\activate`
- Linux/macOS: `source .venv/bin/activate`

Скопируйте `.env.example` в `.env` и заполните значения:

- `BOT_TOKEN` - токен бота
- `CHANNEL_ID` - ID канала (обычно вида `-100...`)
- `ADMIN_IDS` - ID админов через запятую
- `DB_PATH` - путь к SQLite базе
- `MIN_ACCOUNT_AGE_DAYS` - порог "нового аккаунта"
- `MAX_CAPTCHA_ATTEMPTS` - число попыток на капчу

## Запуск

```bash
python main.py
```

## Деплой на VPS

Полная инструкция по деплою как `systemd`-сервиса и запуску без изменений существующего `nginx`:

- `VPS_DEPLOY.md`

## Как работает модерация

- Подозрительная заявка: бот отправляет админам карточку с кнопками `Одобрить` / `Отклонить`.
- Обычная заявка: бот отправляет пользователю математическую капчу.
- Верная капча: бот вызывает `approveChatJoinRequest`.
- Неверная капча после лимита попыток: бот вызывает `declineChatJoinRequest`.
